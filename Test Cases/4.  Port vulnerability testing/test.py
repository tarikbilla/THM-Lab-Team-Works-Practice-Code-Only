import socket, ssl, smtplib, telnetlib, requests, imaplib, subprocess, sys
from ftplib import FTP
from contextlib import closing

TARGET = input("Enter Your IP:");
TIMEOUT = 10

def run_shell(cmd):
    try:
        output = subprocess.check_output(cmd, shell=True, stderr=subprocess.DEVNULL, timeout=10)
        return output.decode(errors='ignore').strip()
    except Exception as e:
        return f"Error: {e}"



print("---- Port 22 (SSH) ----")
try:
    with socket.create_connection((TARGET, 22), timeout=TIMEOUT) as s:
        print('SSH :', s.recv(1024).decode().strip())
except Exception as e:
    print('SSH Error:', e)

print("---- Port 23 (Telnet) ----")
try:
    with telnetlib.Telnet(TARGET, 23, timeout=TIMEOUT) as tn:
        print('Telnet :', tn.read_until(b'\n', timeout=3).decode().strip())
except Exception as e:
    print('Telnet Error:', e)

print("---- Port 25 (SMTP) ----")
try:
    with smtplib.SMTP(TARGET, 25, timeout=TIMEOUT) as smtp:
        _, msg = smtp.ehlo()
        print('SMTP EHLO :', msg.decode().strip())
except Exception as e:
    print('SMTP Error:', e)

print("---- Port 80 (HTTP) ----")
try:
    r = requests.get(f'http://{TARGET}', timeout=TIMEOUT)
    print('HTTP Server :', r.headers.get('Server'))
except Exception as e:
    print('HTTP Error:', e)

print("---- Port 443 (HTTPS) ----")
try:
    context = ssl.create_default_context()
    with socket.create_connection((TARGET, 443), timeout=TIMEOUT) as sock:
        with context.wrap_socket(sock, server_hostname=TARGET) as ss:
            print('HTTPS Cert Subject :', ss.getpeercert().get('subject'))
except Exception as e:
    print('HTTPS Error:', e)

print("---- Port 110 (POP3) ----")
try:
    with socket.create_connection((TARGET, 110), timeout=TIMEOUT) as s:
        print('POP3 :', s.recv(1024).decode().strip())
except Exception as e:
    print('POP3 Error:', e)

print("---- Port 143 (IMAP) ----")
try:
    m = imaplib.IMAP4(TARGET, timeout=TIMEOUT)
    print('IMAP :', m.welcome.decode().strip())
    m.logout()
except Exception as e:
    print('IMAP Error:', e)

print("---- Port 161 (SNMP) ----")
print(run_shell(f"snmpget -v2c -c public {TARGET} 1.3.6.1.2.1.1.1.0"))

print("---- Port 445 (SMB) ----")
print(run_shell(f"nmap -p445 --script smb-os-discovery {TARGET}"))

print("---- Port 139 (NetBIOS) ----")
print(run_shell(f"nmblookup -A {TARGET}"))

print("---- Port 5000 (UPnP) ----")
print(run_shell(f"curl -s http://{TARGET}:5000"))

print("---- Port 1900 (SSDP) ----")
print(run_shell(f"echo -ne 'M-SEARCH * HTTP/1.1\\r\\nHOST:239.255.255.250:1900\\r\\nMAN:\"ssdp:discover\"\\r\\nMX:1\\r\\nST:ssdp:all\\r\\n\\r\\n' | nc -u -w2 {TARGET} 1900"))
